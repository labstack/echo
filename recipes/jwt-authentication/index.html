<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>JWT Authentication - Echo, a fast and unfancy micro web framework for Golang.</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/tomorrow-night.min.css">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/echo.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    
    <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-51208124-3', 'auto');
            ga('send', 'pageview');
        </script>
    
</head>

<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Echo</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../guide/">Guide</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Recipes <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../file-upload/">File Upload</a>
                        </li>
                    
                        <li >
                            <a href="../streaming-file-upload/">Streaming File Upload</a>
                        </li>
                    
                        <li >
                            <a href="../streaming-response/">Streaming Response</a>
                        </li>
                    
                        <li >
                            <a href="../websocket/">WebSocket</a>
                        </li>
                    
                        <li >
                            <a href="../subdomains/">Subdomains</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">JWT Authentication</a>
                        </li>
                    
                        <li >
                            <a href="../graceful-shutdown/">Graceful Shutdown</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../subdomains/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../graceful-shutdown/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/labstack/echo">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

<div class="container">
    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#jwt-authentication">JWT Authentication</a></li>
        
    
        <li class="main "><a href="#source-code">Source Code</a></li>
        
    
    </ul>
</div></div>
    <div class="col-md-9" role="main">

<h2 id="jwt-authentication">JWT Authentication</h2>
<p>Most applications dealing with client authentication will require a more secure
mechanism than that provided by <a href="https://github.com/labstack/echo/blob/master/middleware/auth.go">basic authentication</a>. <a href="http://jwt.io/">JSON Web Tokens</a>
are one such mechanism - JWTs are a compact means of transferring cryptographically
signed claims between the client and server. </p>
<p>This recipe demonstrates the use of a simple JWT authentication Echo middleware
using Dave Grijalva's <a href="https://github.com/dgrijalva/jwt-go">jwt-go</a>. This middleware
expects the token to be present in an Authorization HTTP header using the method
"Bearer", although JWTs are also frequently sent using cookies, the request URL,
or even the request body. We will use the HS236 signing method, note that several
other algorithms are available.</p>
<p><code>server.go</code></p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;net/http&quot;

    &quot;github.com/dgrijalva/jwt-go&quot;
    &quot;github.com/labstack/echo&quot;
    mw &quot;github.com/labstack/echo/middleware&quot;
)

const (
    Bearer     = &quot;Bearer&quot;
    SigningKey = &quot;somethingsupersecret&quot;
)

// A JSON Web Token middleware
func JWTAuth(key string) echo.HandlerFunc {
    return func(c *echo.Context) error {

        // Skip WebSocket
        if (c.Request().Header.Get(echo.Upgrade)) == echo.WebSocket {
            return nil
        }

        auth := c.Request().Header.Get(&quot;Authorization&quot;)
        l := len(Bearer)
        he := echo.NewHTTPError(http.StatusUnauthorized)

        if len(auth) &gt; l+1 &amp;&amp; auth[:l] == Bearer {
            t, err := jwt.Parse(auth[l+1:], func(token *jwt.Token) (interface{}, error) {

                // Always check the signing method
                if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
                    return nil, fmt.Errorf(&quot;Unexpected signing method: %v&quot;, token.Header[&quot;alg&quot;])
                }

                // Return the key for validation
                return []byte(key), nil
            })
            if err == nil &amp;&amp; t.Valid {
                // Store token claims in echo.Context
                c.Set(&quot;claims&quot;, t.Claims)
                return nil
            }
        }
        return he
    }
}

func accessible(c *echo.Context) error {
    return c.String(http.StatusOK, &quot;No auth required for this route.\n&quot;)
}

func restricted(c *echo.Context) error {
    return c.String(http.StatusOK, &quot;Access granted with JWT.\n&quot;)
}

func main() {

    // Echo instance
    e := echo.New()

    // Logger
    e.Use(mw.Logger())

    // Unauthenticated route
    e.Get(&quot;/&quot;, accessible)

    // Restricted group
    r := e.Group(&quot;/restricted&quot;)
    r.Use(JWTAuth(SigningKey))
    r.Get(&quot;&quot;, restricted)

    // Start server
    e.Run(&quot;:1323&quot;)
}
</code></pre>

<p>Run <code>server.go</code> and making a request to the root path <code>/</code> returns a 200 OK response,
as this route does not use our JWT authentication middleware. Sending requests to
<code>/restricted</code> (our authenticated route) with either no Authorization header or invalid
Authorization headers / tokens will return 401 Unauthorized.</p>
<pre><code class="sh"># Unauthenticated route
$ curl localhost:1323/  =&gt; No auth required for this route.

# No Authentication header
$ curl localhost:1323/restricted  =&gt; Unauthorized

# Invalid Authentication method
$  curl localhost:1323/restricted -H &quot;Authorization: Invalid &quot; =&gt; Unauthorized

# Invalid token
$  curl localhost:1323/restricted -H &quot;Authorization: Bearer InvalidToken&quot; =&gt; Unauthorized
</code></pre>

<p>Running <code>token.go</code> (source) will print JWT that is valid against this middleware
to stdout. You can use this token to test succesful authentication on the <code>/restricted</code> path.</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;time&quot;

    &quot;github.com/dgrijalva/jwt-go&quot;
)

const SigningKey = &quot;somethingsupersecret&quot;

func main() {

    // New web token.
    token := jwt.New(jwt.SigningMethodHS256)

    // Set a header and a claim
    token.Header[&quot;typ&quot;] = &quot;JWT&quot;
    token.Claims[&quot;exp&quot;] = time.Now().Add(time.Hour * 96).Unix()

    // Generate encoded token
    t, _ := token.SignedString([]byte(SigningKey))
    fmt.Println(t)
}
</code></pre>

<pre><code class="sh"># Valid token
$  curl localhost:1323/restricted -H &quot;Authorization: Bearer &lt;token&gt;&quot; =&gt; Access granted with JWT.
</code></pre>

<h2 id="source-code"><a href="https://github.com/labstack/echo/blob/master/recipes/jwt-authentication">Source Code</a></h2></div>
</div>

<footer class="col-md-12">
    <hr>
    <center class="social">
        <a href="https://github.com/labstack" target="_blank">
            <i class="fa fa-github fa-2x"></i>
        </a>
        <a href="https://twitter.com/labstack" target="_blank">
            <i class="fa fa-twitter fa-2x"></i>
        </a>
        <a href="https://www.facebook.com/labstack" target="_blank">
            <i class="fa fa-facebook fa-2x"></i>
        </a>
    </center>
    
    <center>&copy; 2015 LabStack</center>
    
</footer>

<script src="../../js/jquery-1.10.2.min.js"></script>
<script src="../../js/bootstrap-3.0.3.min.js"></script>
<script src="../../js/highlight.pack.js"></script>
<script src="../../js/base.js"></script>
</body>
</html>